{% extends 'ask_templates/base.html' %} {% load widget_tweaks %} {% block content %}
<form action="submit/" method="post">
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        {% render_field form.title class+="mdl-textfield__input" %}
        <label class="mdl-textfield__label" for="sample3">Title of your Question?</label>
    </div>
    <div class="trumbowyg-demo">
        {{ form.description }}
    </div>
    {% csrf_token %}
    <center>
    <br>
    <div id="suggested"></div>
    <input type='text'
       placeholder='Select the tags'
       class='flexdatalist'
       data-min-length='1'
       data-selection-required="1"
       data-value-property='id'
       multiple='multiple'
       list='tags'
       name='selectedtags'
       width="200">
    <datalist id="tags">
        {% for tag in tags %}
            <option value="{{tag.id}}">{{tag.name}}</option>
        {% endfor %}
      </datalist>
        <a href="#" class="mdl-button mdl-button--primary mdl-js-button mdl-js-ripple-effect" id="addtag">   +Add new tag</a>
        <center>
        <div class="tagcreated">
            <p class="mdl-button mdl-button--accent">Tag Created</p>
        </div>
        </center>
        <div id="newtagdiv">
            <label for="newtab">Enter new tag name:</label>
            <input type="text" name="new_tag" id="newtag">
            <a href="#" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--accent" id="create_tag">Add tag</a>
        </div>
    <input class="mdl-button mdl-js-button mdl-button--fab mdl-button--primary mdl-js-button" type="submit" value="Ask"></center>
</form>
{% endblock %}
{% block script %}
    <script>
    //Default progress bar
    document.querySelector('#p3').addEventListener('mdl-componentupgraded', function() {
            this.MaterialProgress.setProgress(50);
            this.MaterialProgress.setBuffer(50);
        });
        $(document).ready(function() {
            $('#id_description').trumbowyg();
        });
    //Add new tag 
    $("#newtagdiv").hide();
    $(".tagcreated").hide();
    $("#addtag").click(function(){
        $("#newtagdiv").show();
    })
    //Getting csrf token from stored cookie
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');
    //Attachign the token to the rest header
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
    //Create Tag
    var purl = "http://127.0.0.1:8000{% url 'CreateTag' %}";
    $("#create_tag").click(function(){
        var data = {"name": $("#newtag").val()}
        $.post(purl, data, function(data, status){
            document.getElementById("newtag").value=""
            $(".tagcreated").fadeIn(2000).fadeOut(2000);
            $("#newtagdiv").hide()
        })
    });
    //Get suggested tags adn append to #suggested.
    var surl = "http://127.0.0.1:8000{% url 'SuggestTag' %}";
    $(".mdl-textfield__input").blur(function(){
        if($(this).val()){
        $.post(surl, {"text": $(this).val()}, function(data, status){
            if(status=="success" && data.length){
                for(var i=0;i<(data.length+1);i++){
                    $("#suggested").append("<strong> "+data[i].name+" </strong>");
                }
            }
        });
    }
    });

    </script>
{% endblock script %}